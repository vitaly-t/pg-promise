<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>pg-promise API</title>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-pg-promise.html">pg-promise</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li><li><a href="ParameterizedQuery.html">ParameterizedQuery</a></li><li><a href="PreparedStatement.html">PreparedStatement</a></li><li><a href="QueryFile.html">QueryFile</a></li><li><a href="errors.ParameterizedQueryError.html">ParameterizedQueryError</a></li><li><a href="errors.PreparedStatementError.html">PreparedStatementError</a></li><li><a href="errors.QueryFileError.html">QueryFileError</a></li><li><a href="errors.QueryResultError.html">QueryResultError</a></li><li><a href="helpers.Column.html">Column</a></li><li><a href="helpers.ColumnSet.html">ColumnSet</a></li><li><a href="helpers.TableName.html">TableName</a></li><li><a href="txMode.TransactionMode.html">TransactionMode</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:connect">connect</a></li><li><a href="global.html#event:disconnect">disconnect</a></li><li><a href="global.html#event:error">error</a></li><li><a href="global.html#event:extend">extend</a></li><li><a href="global.html#event:query">query</a></li><li><a href="global.html#event:receive">receive</a></li><li><a href="global.html#event:task">task</a></li><li><a href="global.html#event:transact">transact</a></li></ul><h3>Namespaces</h3><ul><li><a href="errors.html">errors</a></li><li><a href="formatting.html">formatting</a></li><li><a href="formatting.ctf.html">ctf</a></li><li><a href="helpers.html">helpers</a></li><li><a href="txMode.html">txMode</a></li><li><a href="utils.html">utils</a></li></ul><h3>Interfaces</h3><ul><li><a href="Table.html">Table</a></li><li><a href="Task.html">Task</a></li></ul><h3>Global</h3><ul><li><a href="global.html#queryResult">queryResult</a></li></ul>
    <div class="home-link">
        <a href="https://github.com/vitaly-t/pg-promise">&lt;&lt; GitHub</a>
    </div>
</nav>

<div id="main">
    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>QueryFile<span class="signature">(file, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="QueryFile.html">QueryFile</a>}</span></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    

    
    <h4 class="name" id="QueryFile"><span class="type-signature"></span>new QueryFile<span class="signature">(file, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="QueryFile.html">QueryFile</a>}</span></h4>
    

    



<div class="description">
    <p>Represents an external SQL file. The type is available from the library's root: <code>pgp.QueryFile</code>.</p>
<p>Reads a file with SQL and prepares it for execution, also parses and minifies it, if required.
The SQL can be of any complexity, with both single and multi-line comments.</p>
<p>The type can be used in place of the <code>query</code> parameter, with any query method directly, plus as <code>text</code> in <a href="PreparedStatement.html">PreparedStatement</a>
and <a href="ParameterizedQuery.html">ParameterizedQuery</a>.</p>
<p>It never throws any error, leaving it for query methods to reject with <a href="errors.QueryFileError.html">QueryFileError</a>.</p>
<p><strong>IMPORTANT:</strong> You should only create a single reusable object per file, in order to avoid repeated file reads,
as the IO is a very expensive resource. If you do not follow it, you will be seeing the following warning:
<code>Creating a duplicate QueryFile object for the same file</code>, which signals a bad-use pattern.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Path to the SQL file with the query, either absolute or relative to the application's entry point file.</p>
<p>If there is any problem reading the file, it will be reported when executing the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="QueryFile.html#.Options">QueryFile.Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Set of configuration options, as documented by <a href="QueryFile.html#.Options">QueryFile.Options</a>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line26">line 26</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="errors.QueryFileError.html">QueryFileError</a>,<a href="QueryFile.html#toPostgres">toPostgres</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="QueryFile.html">QueryFile</a></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// File sql.js// Proper way to organize an sql provider://// - have all sql files for Users in ./sql/users// - have all sql files for Products in ./sql/products// - have your sql provider module as ./sql/index.jsconst {QueryFile} = require('pg-promise');const {join: joinPath} = require('path');// Helper for linking to external query files:function sql(file) {    const fullPath = joinPath(__dirname, file); // generating full path;    return new QueryFile(fullPath, {minify: true});}module.exports = {    // external queries for Users:    users: {        add: sql('users/create.sql'),        search: sql('users/search.sql'),        report: sql('users/report.sql'),    },    // external queries for Products:    products: {        add: sql('products/add.sql'),        quote: sql('products/quote.sql'),        search: sql('products/search.sql'),    }};</code></pre>

    <pre class="prettyprint"><code>// Testing our SQL providerconst db = require('./db'); // our database module;const {users: sql} = require('./sql'); // sql for users;module.exports = {    addUser: (name, age) => db.none(sql.add, [name, age]),    findUser: name => db.any(sql.search, name)};</code></pre>



    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="error"><span class="type-signature">(readonly) </span>error<span class="type-signature"> :<a href="errors.QueryFileError.html">errors.QueryFileError</a></span></h4>




<div class="description">
    <p>When in an error state, it is set to a <a href="errors.QueryFileError.html">QueryFileError</a> object. Otherwise, it is <code>undefined</code>.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="errors.QueryFileError.html">errors.QueryFileError</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-default">Default Value:</dt>
    <dd class="tag-default"><ul class="dummy">
            <li>undefined</li>
        </ul></dd>
    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line182">line 182</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="file"><span class="type-signature">(readonly) </span>file<span class="type-signature"> :string</span></h4>




<div class="description">
    <p>File name that was passed into the constructor.</p>
<p>This property is primarily for internal use by the library.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">string</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line194">line 194</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="options"><span class="type-signature">(readonly) </span>options<span class="type-signature"> :<a href="QueryFile.html#.Options">QueryFile.Options</a></span></h4>




<div class="description">
    <p>Set of options, as configured during the object's construction.</p>
<p>This property is primarily for internal use by the library.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="QueryFile.html#.Options">QueryFile.Options</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line207">line 207</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id=".instance"><span class="type-signature">(static) </span>instance<span class="type-signature"></span></h4>




<div class="description">
    <p>Global instance of the file-path repository.</p>
</div>







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line153">line 153</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="prepare"><span class="type-signature"></span>prepare<span class="signature">(throwErrors<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    
    <p class="summary"><p>Prepares the query for execution.</p></p>
    



<div class="description">
    <p>If the query hasn't been prepared yet, it will read the file and process the content according
to the parameters passed into the constructor.</p>
<p>This method is primarily for internal use by the library.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>throwErrors</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Throw any error encountered.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line231">line 231</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="toPostgres"><span class="type-signature"></span>toPostgres<span class="signature">(self<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p><a href="https://github.com/vitaly-t/pg-promise#custom-type-formatting">Custom Type Formatting</a>, based on <a href="https://github.com/vitaly-t/pg-promise#symbolic-ctf">Symbolic CTF</a>, i.e. the actual method is available only via <a href="external-Symbol.html">Symbol</a>:</p>
<pre class="prettyprint source lang-js"><code>const {toPostgres} = pgp.as.ctf; // Custom Type Formatting symbols namespace
const query = qf[toPostgres](); // qf = an object of type QueryFile
</code></pre>
<p>This is a raw formatting type (<code>rawType = true</code>), i.e. when used as a query-formatting parameter, type <code>QueryFile</code> injects SQL as raw text.</p>
<p>If you need to support type <code>QueryFile</code> outside of query methods, this is the only safe way to get the most current SQL.
And you would want to use this method dynamically, as it reloads the SQL automatically, if option <code>debug</code> is set.
See <a href="QueryFile.html#.Options">Options</a>.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>self</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="QueryFile.html">QueryFile</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Optional self-reference, for ES6 arrow functions.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line284">line 284</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>SQL string from the file, according to the <a href="QueryFile.html#.Options">options</a> specified.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="toString"><span class="type-signature"></span>toString<span class="signature">(level<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Creates a well-formatted multi-line string that represents the object's current state.</p>
<p>It is called automatically when writing the object into the console.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>level</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    0
                
                </td>
            

            <td class="description last"><p>Nested output level, to provide visual offset.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line315">line 315</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id=".Options">Options</h4>




<div class="description">
    <p>A set of configuration options as passed into the <a href="QueryFile.html">QueryFile</a> constructor.</p>
</div>







    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>debug</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>When in debug mode, the query file is checked for its last modification time on every query request,
so if it changes, the file is read afresh.</p>
<p>The default for this property is <code>true</code> when <code>NODE_ENV</code> = <code>development</code>,
or <code>false</code> otherwise.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>minify</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Parses and minifies the SQL using <a href="https://github.com/vitaly-t/pg-minify">pg-minify</a>:</p>
<ul>
<li><code>false</code> - do not use <a href="https://github.com/vitaly-t/pg-minify">pg-minify</a></li>
<li><code>true</code> - use <a href="https://github.com/vitaly-t/pg-minify">pg-minify</a> to parse and minify SQL</li>
<li><code>'after'</code> - use <a href="https://github.com/vitaly-t/pg-minify">pg-minify</a> after applying static formatting parameters
(option <code>params</code>), as opposed to before it (default)</li>
</ul>
<p>If option <code>compress</code> is set, then the default for <code>minify</code> is <code>true</code>.</p>
<p>Failure to parse SQL will result in <a href="https://github.com/vitaly-t/pg-minify/blob/master/lib/error.js">SQLParsingError</a>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>compress</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Sets option <code>compress</code> as supported by <a href="https://github.com/vitaly-t/pg-minify">pg-minify</a>, to uglify the SQL:</p>
<ul>
<li><code>false</code> - no compression to be applied, keep minimum spaces for easier read</li>
<li><code>true</code> - remove all unnecessary spaces from SQL</li>
</ul>
<p>This option has no meaning, if <code>minify</code> is explicitly set to <code>false</code>. However, if <code>minify</code> is not
specified and <code>compress</code> is specified as <code>true</code>, then <code>minify</code> defaults to <code>true</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>params</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">object</span>
|

<span class="param-type">value</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Static formatting parameters to be applied to the SQL, using the same method <a href="formatting.html#.format">as.format</a>,
but with option <code>partial</code> = <code>true</code>.</p>
<p>Most of the time query formatting is fully dynamic, and applied just before executing the query.
In some cases though you may need to pre-format SQL with static values. Examples of it can be a
schema name, or a configurable table name.</p>
<p>This option makes two-step SQL formatting easy: you can pre-format the SQL initially, and then
apply the second-step dynamic formatting when executing the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noWarnings</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Suppresses all warnings produced by the class. It is not recommended for general use, only in specific tests
that may require it.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="query-file.js.html">query-file.js</a>, <a href="query-file.js.html#line351">line 351</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
    

    
</article>

</section>




</div>

<br class="clear">

<footer>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>