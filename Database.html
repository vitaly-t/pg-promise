<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>pg-promise API</title>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-pg-promise.html">pg-promise</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li><li><a href="ParameterizedQuery.html">ParameterizedQuery</a></li><li><a href="PreparedStatement.html">PreparedStatement</a></li><li><a href="QueryFile.html">QueryFile</a></li><li><a href="errors.ParameterizedQueryError.html">ParameterizedQueryError</a></li><li><a href="errors.PreparedStatementError.html">PreparedStatementError</a></li><li><a href="errors.QueryFileError.html">QueryFileError</a></li><li><a href="errors.QueryResultError.html">QueryResultError</a></li><li><a href="helpers.Column.html">Column</a></li><li><a href="helpers.ColumnSet.html">ColumnSet</a></li><li><a href="helpers.TableName.html">TableName</a></li><li><a href="txMode.TransactionMode.html">TransactionMode</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:connect">connect</a></li><li><a href="global.html#event:disconnect">disconnect</a></li><li><a href="global.html#event:error">error</a></li><li><a href="global.html#event:extend">extend</a></li><li><a href="global.html#event:query">query</a></li><li><a href="global.html#event:receive">receive</a></li><li><a href="global.html#event:task">task</a></li><li><a href="global.html#event:transact">transact</a></li></ul><h3>Namespaces</h3><ul><li><a href="errors.html">errors</a></li><li><a href="formatting.html">formatting</a></li><li><a href="formatting.ctf.html">ctf</a></li><li><a href="helpers.html">helpers</a></li><li><a href="txMode.html">txMode</a></li><li><a href="utils.html">utils</a></li></ul><h3>Interfaces</h3><ul><li><a href="Table.html">Table</a></li><li><a href="Task.html">Task</a></li></ul><h3>Global</h3><ul><li><a href="global.html#queryResult">queryResult</a></li></ul>
    <div class="home-link">
        <a href="https://github.com/vitaly-t/pg-promise">&lt;&lt; GitHub</a>
    </div>
</nav>

<div id="main">
    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>Database<span class="signature">(cn, dc<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="Database.html">Database</a>}</span></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    

    
    <h4 class="name" id="Database"><span class="type-signature"></span>new Database<span class="signature">(cn, dc<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="Database.html">Database</a>}</span></h4>
    

    



<div class="description">
    <p>Represents the database protocol, extensible via event <a href="global.html#event:extend">extend</a>.
This type is not available directly, it can only be created via the library's base call.</p>
<p><strong>IMPORTANT:</strong></p>
<p>For any given connection, you should only create a single <a href="Database.html">Database</a> object in a separate module,
to be shared in your application (see the code example below). If instead you keep creating the <a href="Database.html">Database</a>
object dynamically, your application will suffer from loss in performance, and will be getting a warning in a
development environment (when <code>NODE_ENV</code> = <code>development</code>):</p>
<p><code>WARNING: Creating a duplicate database object for the same connection.</code></p>
<p>If you ever see this warning, rectify your <a href="Database.html">Database</a> object initialization, so there is only one object
per connection details. See the example provided below.</p>
<p>See also: property <code>noWarnings</code> in <a href="module-pg-promise.html">Initialization Options</a>.</p>
<p>Note however, that in special cases you may need to re-create the database object, if its connection pool has been
shut-down externally. And in this case the library won't be showing any warning.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cn</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Database connection details, which can be:</p>
<ul>
<li>a configuration object</li>
<li>a connection string</li>
</ul>
<p>For details see <a href="https://github.com/vitaly-t/pg-promise/wiki/Connection-Syntax">Connection Syntax</a>.</p>
<p>The value can be accessed from the database object via property $cn.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>dc</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Database Context.</p>
<p>Any object or value to be propagated through the protocol, to allow implementations and event handling
that depend on the database context.</p>
<p>This is mainly to facilitate the use of multiple databases which may need separate protocol extensions,
or different implementations within a single task / transaction callback, depending on the database context.</p>
<p>This parameter also adds uniqueness to the connection context that's used in combination with the connection
parameters, i.e. use of unique database context will prevent getting the warning about creating a duplicate
Database object.</p>
<p>The value can be accessed from the database object via property <a href="Database.html#$dc">$dc</a>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line26">line 26</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#query">query</a>,<a href="Database.html#none">none</a>,<a href="Database.html#one">one</a>,<a href="Database.html#oneOrNone">oneOrNone</a>,<a href="Database.html#many">many</a>,<a href="Database.html#manyOrNone">manyOrNone</a>,<a href="Database.html#any">any</a>,<a href="Database.html#func">func</a>,<a href="Database.html#proc">proc</a>,<a href="Database.html#result">result</a>,<a href="Database.html#multiResult">multiResult</a>,<a href="Database.html#multi">multi</a>,<a href="Database.html#map">map</a>,<a href="Database.html#each">each</a>,<a href="Database.html#stream">stream</a>,<a href="Database.html#task">task</a>,<a href="Database.html#taskIf">taskIf</a>,<a href="Database.html#tx">tx</a>,<a href="Database.html#txIf">txIf</a>,<a href="Database.html#connect">connect</a>,<a href="Database.html#$config">$config</a>,<a href="Database.html#$cn">$cn</a>,<a href="Database.html#$dc">$dc</a>,<a href="Database.html#$pool">$pool</a>,<a href="global.html#event:extend">extend</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="Database.html">Database</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// Proper way to initialize and share the Database object// Loading and initializing the library:const pgp = require('pg-promise')({    // Initialization Options});// Preparing the connection details:const cn = 'postgres://username:password@host:port/database';// Creating a new database instance from the connection details:const db = pgp(cn);// Exporting the database object for shared use:module.exports = db;</code></pre>



    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="$cn"><span class="type-signature">(readonly) </span>$cn<span class="type-signature"> :string|object</span></h4>




<div class="description">
    <p>Database connection, as was passed in during the object's construction.</p>
<p>This is a hidden property, to help integrating type <a href="Database.html">Database</a> directly with third-party libraries.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">string</span>
|

<span class="param-type">object</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line358">line 358</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html">Database</a></li>
        </ul>
    </dd>
    

    
</dl>






        
            
<h4 class="name" id="$config"><span class="type-signature">(readonly) </span>$config<span class="type-signature"> :object</span></h4>




<div class="description">
    <p>This is a hidden property, to help integrating type <a href="Database.html">Database</a> directly with third-party libraries.</p>
<p>Properties available in the object:</p>
<ul>
<li><code>pgp</code> - instance of the entire library after initialization</li>
<li><code>options</code> - the library's <a href="module-pg-promise.html">Initialization Options</a> object</li>
<li><code>version</code> - this library's version</li>
<li><code>$npm</code> <em>(hidden property)</em> - internal module cache</li>
</ul>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line344">line 344</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="$dc"><span class="type-signature">(readonly) </span>$dc<span class="type-signature"> :*</span></h4>




<div class="description">
    <p>Database Context, as was passed in during the object's construction.</p>
<p>This is a hidden property, to help integrating type <a href="Database.html">Database</a> directly with third-party libraries.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">*</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line370">line 370</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html">Database</a></li>
        </ul>
    </dd>
    

    
</dl>






        
            
<h4 class="name" id="$pool"><span class="type-signature">(readonly) </span>$pool<span class="type-signature"> :<a href="external-pg-pool.html">external:pg-pool</a></span></h4>




<div class="description">
    <p>A <a href="https://github.com/brianc/node-postgres/tree/master/packages/pg-pool">pg-pool</a> object associated with the database object, as each <a href="Database.html">Database</a> creates its own <a href="https://github.com/brianc/node-postgres/tree/master/packages/pg-pool">pg-pool</a> instance.</p>
<p>This is a hidden property, primarily for integrating type <a href="Database.html">Database</a> with third-party libraries that support
<a href="https://github.com/brianc/node-postgres/tree/master/packages/pg-pool">pg-pool</a> directly. Note however, that if you pass the pool object into a library that calls <code>pool.end()</code>, you will no longer be able
to use this <a href="Database.html">Database</a> object, and each query method will be rejecting with <a href="external-Error.html">Error</a> =
<code>Connection pool of the database object has been destroyed.</code></p>
<p>You can also use this object to shut down the pool, by calling <code>$pool.end()</code>.</p>
<p>For more details see <a href="https://github.com/vitaly-t/pg-promise#library-de-initialization">Library de-initialization</a>.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="external-pg-pool.html">external:pg-pool</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line382">line 382</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html">Database</a><a href="module-pg-promise.html#~end">pgp.end</a></li>
        </ul>
    </dd>
    

    
</dl>





    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// Shutting down the connection pool of this database object,// after all queries have finished in a run-though process:.then(() => {}) // processing the data.catch() => {}) // handling the error.finally(db.$pool.end); // shutting down the pool</code></pre>



        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="any"><span class="type-signature"></span>any<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that can return any number of rows.
This is simply a shorter alias for method <a href="Database.html#manyOrNone">manyOrNone</a>.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line711">line 711</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#manyOrNone">manyOrNone</a>,<a href="Database.html#map">map</a>,<a href="Database.html#each">each</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When no rows are returned, it resolves with an empty array.</li>
<li>When 1 or more rows are returned, it resolves with the array of rows.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="connect"><span class="type-signature"></span>connect<span class="signature">(options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Acquires a new or existing connection, depending on the current state of the connection pool, and parameter <code>direct</code>.</p>
<p>This method creates a shared connection for executing a chain of queries against it. The connection must be released
in the end of the chain by calling <code>done()</code> on the connection object.</p>
<p>Method <code>done</code> takes one optional parameter - boolean <code>kill</code> flag, to signal the connection pool that you want it to kill
the physical connection. This flag is ignored for direct connections, as they always close when released.</p>
<p>It should not be used just for chaining queries on the same connection, methods <a href="Database.html#task">task</a> and
<a href="Database.html#tx">tx</a> (for transactions) are to be used for that. This method is primarily for special cases, like
<code>LISTEN</code> notifications.</p>
<p><strong>NOTE:</strong> Even though this method exposes a <a href="external-Client.html">Client</a> object via property <code>client</code>,
you cannot call <code>client.end()</code> directly, or it will print an error into the console:
<code>Abnormal client.end() call, due to invalid code or failed server connection.</code>
You should only call method <code>done()</code> to release the connection.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Connection Options.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>direct</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>Creates a new connection directly, as a stand-alone <a href="external-Client.html">Client</a> object, bypassing the connection pool.</p>
<p>By default, all connections are acquired from the connection pool. But if you set this option, the library will instead
create a new <a href="external-Client.html">Client</a> object directly (separately from the pool), and then call its <code>connect</code> method.</p>
<p>Note that specifically for direct connections, method <code>done</code> returns a <a href="external-Promise.html">Promise</a>, because those connections
are closed physically, which may take time.</p>
<p><strong>WARNING:</strong></p>
<p>Do not use this option for regular query execution, because it exclusively occupies one physical channel, and it cannot scale.
This option is only suitable for global connection usage, such as event listeners.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>onLost</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Notification callback of the lost/broken connection, called with the following parameters:</p>
<ul>
<li><code>err</code> - the original connectivity error</li>
<li><code>e</code> - error context object, which contains:
<ul>
<li><code>cn</code> - safe connection string/config (with the password hashed);</li>
<li><code>dc</code> - Database Context, as was used during <a href="Database.html">Database</a> construction;</li>
<li><code>start</code> - Date/Time (<code>Date</code> type) when the connection was established;</li>
<li><code>client</code> - <a href="external-Client.html">Client</a> object that has lost the connection.</li>
</ul>
</li>
</ul>
<p>The notification is mostly valuable with <code>direct: true</code>, to be able to re-connect direct/permanent connections by calling
method <a href="Database.html#connect">connect</a> again.</p>
<p>You do not need to call <code>done</code> on lost connections, as it happens automatically. However, if you had event listeners
set up on the connection's <code>client</code> object, you should remove them to avoid leaks:</p>
<pre class="prettyprint source lang-js"><code>function onLostConnection(err, e) {
    e.client.removeListener('my-event', myHandler);
}
</code></pre>
<p>For a complete example see <a href="https://github.com/vitaly-t/pg-promise/wiki/Robust-Listeners">Robust Listeners</a>.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line139">line 139</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#task">Database.task</a>,<a href="Database.html#taskIf">Database.taskIf</a>,<a href="Database.html#tx">Database.tx</a>,<a href="Database.html#txIf">Database.txIf</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the connection result:</p>
<ul>
<li>resolves with the complete <a href="Database.html">Database</a> protocol, extended with:
<ul>
<li>property <code>client</code> of type <a href="external-Client.html">Client</a> that represents the open connection</li>
<li>method <code>done</code> that must be called in the end, in order to release the connection (returns a <a href="external-Promise.html">Promise</a>
in case of direct connections)</li>
<li>methods <code>batch</code>, <code>page</code> and <code>sequence</code>, same as inside a <a href="Task.html">Task</a></li>
</ul>
</li>
<li>rejects with a connection-related error when it fails to connect.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>let sco; // shared connection object;db.connect()    .then(obj => {        // obj.client = new connected Client object;        sco = obj; // save the connection object;        // execute all the queries you need:        return sco.any('SELECT * FROM Users');    })    .then(data => {        // success    })    .catch(error => {        // error    })    .finally(() => {        // release the connection, if it was successful:        if (sco) {            // if you pass `true` into method done, i.e. done(true),            // it will make the pool kill the physical connection.            sco.done();        }    });</code></pre>



        
            

    

    
    <h4 class="name" id="each"><span class="type-signature"></span>each<span class="signature">(query, values<span class="signature-attributes">opt</span>, cb, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;Object>>}</span></h4>
    

    



<div class="description">
    <p>Executes a provided function once per array element, for an array of rows resolved by method <a href="Database.html#any">any</a>.</p>
<p>It is a convenience method to reduce the following code:</p>
<pre class="prettyprint source lang-js"><code>db.any(query, values)
    .then(data => {
        data.forEach((row, index, data) => {
             // process the row
        });
        return data;
    });
</code></pre>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Function to execute for each row, taking three arguments:</p>
<ul>
<li><code>row</code> - the current row object being processed in the array</li>
<li><code>index</code> - the index of the current row being processed in the array</li>
<li><code>data</code> - the array of rows resolved by method <a href="Database.html#any">any</a></li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1114">line 1114</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#any">any</a>,<a href="Database.html#map">map</a>,<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">Array.forEach</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Resolves with the original array of rows.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;Object>></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>db.each('SELECT id, code, name FROM Events', [], row => {    row.code = parseInt(row.code);})    .then(data => {        // data = array of events, with 'code' converted into integer    })    .catch(error => {        // error    });</code></pre>



        
            

    

    
    <h4 class="name" id="func"><span class="type-signature"></span>func<span class="signature">(funcName, values<span class="signature-attributes">opt</span>, qrm<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a database function that returns a table, abbreviating the full syntax
of <code>query('SELECT * FROM $1:alias($2:csv)', [funcName, values], qrm)</code>.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>funcName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Name of the function to be executed.
When it is not same-case, or contains extended symbols, it is double-quoted, as per the <code>:alias</code> filter,
which also supports <code>.</code>, to auto-split into a composite name.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Parameters for the function - one value | array of values | function returning value(s).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>qrm</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#queryResult">queryResult</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    queryResult.any
                
                </td>
            

            <td class="description last"><p><a href="global.html#queryResult">Query Result Mask</a>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line939">line 939</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#query">query</a>,<a href="Database.html#proc">proc</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object as returned from method <a href="Database.html#query">query</a>, according to parameter <code>qrm</code>.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="many"><span class="type-signature"></span>many<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that expects one or more rows to be returned. When the query returns no rows, the method rejects.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line563">line 563</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When 1 or more rows are returned, it resolves with the array of rows.</li>
<li>When no rows are returned, it rejects with <a href="errors.QueryResultError.html">QueryResultError</a>:
<ul>
<li><code>.message</code> = <code>No data returned from the query.</code></li>
<li><code>.code</code> = <a href="errors.html#.queryResultErrorCode#.noData">queryResultErrorCode.noData</a></li>
</ul>
</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="manyOrNone"><span class="type-signature"></span>manyOrNone<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that can return any number of rows.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line668">line 668</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#any">any</a>,<a href="Database.html#many">many</a>,<a href="Database.html#none">none</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When no rows are returned, it resolves with an empty array.</li>
<li>When 1 or more rows are returned, it resolves with the array of rows.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="map"><span class="type-signature"></span>map<span class="signature">(query, values, cb, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array>}</span></h4>
    

    



<div class="description">
    <p>Creates a new array with the results of calling a provided function on every element in the array of rows
resolved by method <a href="Database.html#any">any</a>.</p>
<p>It is a convenience method, to reduce the following code:</p>
<pre class="prettyprint source lang-js"><code>db.any(query, values)
    .then(data => {
        return data.map((row, index, data) => {
             // return a new element
        });
    });
</code></pre>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Function that produces an element of the new array, taking three arguments:</p>
<ul>
<li><code>row</code> - the current row object being processed in the array</li>
<li><code>index</code> - the index of the current row being processed in the array</li>
<li><code>data</code> - the original array of rows resolved by method <a href="Database.html#any">any</a></li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1008">line 1008</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#any">any</a>,<a href="Database.html#each">each</a>,<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">Array.map</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Resolves with the new array of values returned from the callback.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>db.map('SELECT id FROM Users WHERE status = $1', ['active'], row => row.id)    .then(data => {        // data = array of active user id-s    })    .catch(error => {       // error    });</code></pre>

    <pre class="prettyprint"><code>db.tx(t => {    return t.map('SELECT id FROM Users WHERE status = $1', ['active'], row => {       return t.none('UPDATE Events SET checked = $1 WHERE userId = $2', [true, row.id]);    }).then(t.batch);})    .then(data => {        // success    })    .catch(error => {        // error    });</code></pre>

    <pre class="prettyprint"><code>// Build a list of active users, each with the list of user events:db.task(t => {    return t.map('SELECT id FROM Users WHERE status = $1', ['active'], user => {        return t.any('SELECT * FROM Events WHERE userId = $1', user.id)            .then(events=> {                user.events = events;                return user;            });    }).then(t.batch);})    .then(data => {        // success    })    .catch(error => {        // error    });</code></pre>



        
            

    

    
    <h4 class="name" id="multi"><span class="type-signature"></span>multi<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;Array>>}</span></h4>
    

    



<div class="description">
    <p>Executes a multi-query string, without any expectation for the return data, and resolves with an array
of arrays of rows when successful.</p>
<p>The operation is atomic, i.e. all queries are executed in a single transaction, unless there are explicit
<code>BEGIN/COMMIT</code> commands included in the query string to divide it into multiple transactions.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Multi-query string to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty string that can contain any number of queries</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line861">line 861</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#multiResult">multiResult</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;Array>></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// Get data from 2 tables in a single request:const [users, products] = await db.multi('SELECT * FROM users;SELECT * FROM products');</code></pre>



        
            

    

    
    <h4 class="name" id="multiResult"><span class="type-signature"></span>multiResult<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;<a href="external-Result.html">external:Result</a>>>}</span></h4>
    

    



<div class="description">
    <p>Executes a multi-query string, without any expectation for the return data, and resolves with an array
of the original <a href="https://node-postgres.com/apis/result">Result</a> objects when successful.</p>
<p>The operation is atomic, i.e. all queries are executed in a single transaction, unless there are explicit
<code>BEGIN/COMMIT</code> commands included in the query string to divide it into multiple transactions.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Multi-query string to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty string that can contain any number of queries</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line822">line 822</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#multi">multi</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;Array.&lt;<a href="external-Result.html">external:Result</a>>></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="none"><span class="type-signature"></span>none<span class="signature">(query, values<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>.&lt;null>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that expects no data to be returned. If the query returns any data,
the method rejects.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line449">line 449</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When no records are returned, it resolves with <code>null</code>.</li>
<li>When any data is returned, it rejects with <a href="errors.QueryResultError.html">QueryResultError</a>:
<ul>
<li><code>.message</code> = <code>No return data was expected.</code></li>
<li><code>.code</code> = <a href="errors.html#.queryResultErrorCode#.notEmpty">queryResultErrorCode.notEmpty</a></li>
</ul>
</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a>.&lt;null></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="one"><span class="type-signature"></span>one<span class="signature">(query, values<span class="signature-attributes">opt</span>, cb<span class="signature-attributes">opt</span>, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that expects exactly 1 row to be returned. When 0 or more than 1 rows are returned,
the method rejects.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value-transformation callback, to allow in-line value change.
When specified, the returned value replaces the original one.</p>
<p>The function takes only one parameter - value resolved from the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the transformation callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line489">line 489</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#oneOrNone">oneOrNone</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When 1 row is returned, it resolves with that row as a single object.</li>
<li>When no rows are returned, it rejects with <a href="errors.QueryResultError.html">QueryResultError</a>:
<ul>
<li><code>.message</code> = <code>No data returned from the query.</code></li>
<li><code>.code</code> = <a href="errors.html#.queryResultErrorCode#.noData">queryResultErrorCode.noData</a></li>
</ul>
</li>
<li>When multiple rows are returned, it rejects with <a href="errors.QueryResultError.html">QueryResultError</a>:
<ul>
<li><code>.message</code> = <code>Multiple rows were not expected.</code></li>
<li><code>.code</code> = <a href="errors.html#.queryResultErrorCode#.multiple">queryResultErrorCode.multiple</a></li>
</ul>
</li>
<li>Resolves with the new value, if transformation callback <code>cb</code> was specified.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// a query with in-line value transformation:db.one('INSERT INTO Events VALUES($1) RETURNING id', [123], event => event.id)    .then(data => {        // data = a new event id, rather than an object with it    });</code></pre>

    <pre class="prettyprint"><code>// a query with in-line value transformation + conversion:db.one('SELECT count(*) FROM Users', [], c => +c.count)    .then(count => {        // count = a proper integer value, rather than an object with a string    });</code></pre>



        
            

    

    
    <h4 class="name" id="oneOrNone"><span class="type-signature"></span>oneOrNone<span class="signature">(query, values<span class="signature-attributes">opt</span>, cb<span class="signature-attributes">opt</span>, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a query that expects 0 or 1 rows to be returned. It resolves with the row-object when 1 row is returned,
or with <code>null</code> when nothing is returned. When the query returns more than 1 row, the method rejects.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value-transformation callback, to allow in-line value change.
When specified, the returned value replaces the original one.</p>
<p>The function takes only one parameter - value resolved from the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the transformation callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line602">line 602</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#one">one</a>,<a href="Database.html#none">none</a>,<a href="Database.html#manyOrNone">manyOrNone</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>When no rows are returned, it resolves with <code>null</code>.</li>
<li>When 1 row is returned, it resolves with that row as a single object.</li>
<li>When multiple rows are returned, it rejects with <a href="errors.QueryResultError.html">QueryResultError</a>:
<ul>
<li><code>.message</code> = <code>Multiple rows were not expected.</code></li>
<li><code>.code</code> = <a href="errors.html#.queryResultErrorCode#.multiple">queryResultErrorCode.multiple</a></li>
</ul>
</li>
<li>Resolves with the new value, if transformation callback <code>cb</code> was specified.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// a query with in-line value transformation:db.oneOrNone('SELECT id FROM Events WHERE type = $1', ['entry'], e => e &amp;&amp; e.id)    .then(data => {        // data = the event id or null (rather than object or null)    });</code></pre>



        
            

    

    
    <h4 class="name" id="proc"><span class="type-signature"></span>proc<span class="signature">(procName, values<span class="signature-attributes">opt</span>, cb<span class="signature-attributes">opt</span>, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a stored procedure by name, abbreviating the full syntax of
<code>oneOrNone('CALL $1:alias($2:csv)', [procName, values], cb, thisArg)</code>.</p>
<p><strong>NOTE:</strong> This method uses the new <code>CALL</code> syntax that requires PostgreSQL v11 or later.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>procName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Name of the stored procedure to be executed.
When it is not same-case, or contains extended symbols, it is double-quoted, as per the <code>:alias</code> filter,
which also supports <code>.</code>, to auto-split into a composite SQL name.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Parameters for the procedure - one value | array of values | function returning value(s).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value-transformation callback, to allow in-line value change.
When specified, the returned value replaces the original one.</p>
<p>The function takes only one parameter - value resolved from the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the transformation callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line967">line 967</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Database.html#func">func</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>When the procedure takes output parameters, a single object is returned, with
properties for the output values. Otherwise, the method resolves with <code>null</code>.
And if the value-transformation callback is provided, it overrides the result.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="query"><span class="type-signature"></span>query<span class="signature">(query, values<span class="signature-attributes">opt</span>, qrm<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Base query method that executes a generic query, expecting the return data according to parameter <code>qrm</code>.</p>
<p>It performs the following steps:</p>
<ol>
<li>Validates and formats the query via <a href="formatting.html#.format">as.format</a>, according to the <code>query</code> and <code>values</code> passed in;</li>
<li>For a root-level query (against the <a href="Database.html">Database</a> object), it requests a new connection from the pool;</li>
<li>Executes the query;</li>
<li>For a root-level query (against the <a href="Database.html">Database</a> object), it releases the connection back to the pool;</li>
<li>Resolves/rejects, according to the data returned from the query and the value of <code>qrm</code>.</li>
</ol>
<p>Direct use of this method is not suitable for chaining queries, for performance reasons. It should be done
through either task or transaction context, see <a href="https://github.com/vitaly-t/pg-promise/wiki/Chaining-Queries">Chaining Queries</a>.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>qrm</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#queryResult">queryResult</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    queryResult.any
                
                </td>
            

            <td class="description last"><p><a href="global.html#queryResult">Query Result Mask</a></p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line281">line 281</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result according to <code>qrm</code>.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="result"><span class="type-signature"></span>result<span class="signature">(query, values<span class="signature-attributes">opt</span>, cb<span class="signature-attributes">opt</span>, thisArg<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a query without any expectation for the return data, and resolves with the
original <a href="https://node-postgres.com/apis/result">Result</a> object when successful.</p>
<p>When receiving a multi-query result, only the last result is processed, ignoring the rest.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">function</span>
|

<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Query to be executed, which can be any of the following types:</p>
<ul>
<li>A non-empty query string</li>
<li>A function that returns a query string or another function, i.e. recursive resolution
is supported, passing in <code>values</code> as <code>this</code>, and as the first parameter.</li>
<li>Prepared Statement <code>{name, text, values, ...}</code> or <a href="PreparedStatement.html">PreparedStatement</a> object</li>
<li>Parameterized Query <code>{text, values, ...}</code> or <a href="ParameterizedQuery.html">ParameterizedQuery</a> object</li>
<li><a href="QueryFile.html">QueryFile</a> object</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>
|

<span class="param-type">value</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Query formatting parameter(s), or a function that returns it.</p>
<p>When <code>query</code> is of type <code>string</code> or a <a href="QueryFile.html">QueryFile</a> object, the <code>values</code> can be:</p>
<ul>
<li>a single value - to replace all <code>$1</code> occurrences</li>
<li>an array of values - to replace all <code>$1</code>, <code>$2</code>, ... variables</li>
<li>an object - to apply <a href="https://github.com/vitaly-t/pg-promise#named-parameters">Named Parameters</a> formatting</li>
</ul>
<p>When <code>query</code> is a Prepared Statement or a Parameterized Query (or their class types),
and <code>values</code> is not <code>null</code> or <code>undefined</code>, it is automatically set within such object,
as an override for its internal <code>values</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value-transformation callback, to allow in-line value change.
When specified, the returned value replaces the original one.</p>
<p>The function takes only one parameter - value resolved from the query.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>thisArg</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Value to use as <code>this</code> when executing the transformation callback.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line755">line 755</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object that represents the query result:</p>
<ul>
<li>resolves with the original <a href="https://node-postgres.com/apis/result">Result</a> object (by default);</li>
<li>resolves with the new value, if transformation callback <code>cb</code> was specified.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// use of value transformation:// deleting rows and returning the number of rows deleteddb.result('DELETE FROM Events WHERE id = $1', [123], r => r.rowCount)    .then(data => {        // data = number of rows that were deleted    });</code></pre>

    <pre class="prettyprint"><code>// use of value transformation:// getting only column details from a tabledb.result('SELECT * FROM Users LIMIT 0', null, r => r.fields)    .then(data => {        // data = array of column descriptors    });</code></pre>



        
            

    

    
    <h4 class="name" id="stream"><span class="type-signature"></span>stream<span class="signature">(qs, initCB)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Custom data streaming, with the help of <a href="https://github.com/brianc/node-postgres/tree/master/packages/pg-query-stream">pg-query-stream</a>.</p>
<p>This method doesn't work with the <a href="https://node-postgres.com/features/native">Native Bindings</a>, and if option <code>pgNative</code>
is set, it will reject with <code>Streaming doesn't work with Native Bindings.</code></p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>qs</code></td>
            

            <td class="type">
            
                
<span class="param-type">QueryStream</span>


            
            </td>

            

            

            <td class="description last"><p>Stream object of type <a href="https://github.com/brianc/node-postgres/blob/master/packages/pg-query-stream/src/index.ts">QueryStream</a>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>initCB</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Database.html#.streamInitCB">Database.streamInitCB</a></span>


            
            </td>

            

            

            <td class="description last"><p>Stream initialization callback.</p>
<p>It is invoked with the same <code>this</code> context as the calling method.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line906">line 906</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Result of the streaming operation.</p>
<p>Once the streaming has finished successfully, the method resolves with
<code>{processed, duration}</code>:</p>
<ul>
<li><code>processed</code> - total number of rows processed;</li>
<li><code>duration</code> - streaming duration, in milliseconds.</li>
</ul>
<p>Possible rejections messages:</p>
<ul>
<li><code>Invalid or missing stream object.</code></li>
<li><code>Invalid stream state.</code></li>
<li><code>Invalid or missing stream initialization callback.</code></li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="task"><span class="type-signature"></span>task<span class="signature">(options<span class="signature-attributes">opt</span>, cb)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a callback function with automatically managed connection.</p>
<p>When invoked on the root <a href="Database.html">Database</a> object, the method allocates the connection from the pool,
executes the callback, and once finished - releases the connection back to the pool.
However, when invoked inside another task or transaction, the method reuses the parent connection.</p>
<p>This method should be used whenever executing more than one query at once, so the allocated connection
is reused between all queries, and released only after the task has finished (see <a href="https://github.com/vitaly-t/pg-promise/wiki/Chaining-Queries">Chaining Queries</a>).</p>
<p>The callback function is called with one parameter - database protocol (same as <code>this</code>), extended with methods
<a href="Task.html#batch">batch</a>, <a href="Task.html#page">page</a>, <a href="Task.html#sequence">sequence</a>, plus property <a href="Task.html#ctx">ctx</a> -
the task context object. See class <a href="Task.html">Task</a> for more details.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>
|

<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>This parameter is optional, and presumed skipped when the first parameter is a function (<code>cb</code> parameter).</p>
<p>When it is of type <code>string</code> or <code>number</code>, it is assumed to be option <code>tag</code> passed in directly. Otherwise,
it is expected to be an object with options as listed below.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tag</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Traceable context for the task (see <a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>).</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Task callback function, to return the result that will determine either success or failure for the operation.</p>
<p>The function can be either the first of the second parameter passed into the method.</p>
<p>It also can be an ES7 <code>async</code> function.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1192">line 1192</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Task.html">Task</a>,<a href="Database.html#taskIf">taskIf</a>,<a href="Database.html#tx">tx</a>,<a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>,<a href="https://github.com/vitaly-t/pg-promise/wiki/Chaining-Queries">Chaining Queries</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object with the result from the callback function.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>db.task('my-task', async t => {        // t.ctx = task context object        const user = await t.one('SELECT id FROM Users WHERE name = $1', ['John']);        return t.any('SELECT * FROM Events WHERE userId = $1', [user.id]);    })    .then(data => {        // success        // data = as returned from the task's callback    })    .catch(error => {        // error    });</code></pre>



        
            

    

    
    <h4 class="name" id="taskIf"><span class="type-signature"></span>taskIf<span class="signature">(options<span class="signature-attributes">opt</span>, cb)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a conditional task that results in an actual new <a href="Database.html#task">task</a>, if either condition is met or
when it is necessary (on the top level), or else it reuses the current connection context.</p>
<p>The default condition is <code>not in task or transaction</code>, to start a task only if currently not inside another task or transaction,
which is the same as calling the following:</p>
<pre class="prettyprint source lang-js"><code>db.taskIf({cnd: t => !t.ctx}, cb => {})
</code></pre>
<p>It can be useful, if you want to simplify/reduce the task + log events footprint, by creating new tasks only when necessary.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>
|

<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>This parameter is optional, and presumed skipped when the first parameter is a function (<code>cb</code> parameter).</p>
<p>When it is of type <code>string</code> or <code>number</code>, it is assumed to be option <code>tag</code> passed in directly. Otherwise,
it is expected to be an object with options as listed below.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tag</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Traceable context for the task/transaction (see <a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cnd</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Condition for creating a (<a href="Database.html#task">task</a>), if it is met.
It can be either a simple boolean, or a callback function that takes the task context as <code>this</code> and as the first parameter.</p>
<p>Default condition (when it is not specified):</p>
<pre class="prettyprint source lang-js"><code>{cnd: t => !t.ctx}
</code></pre></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Task callback function, to return the result that will determine either success or failure for the operation.</p>
<p>The function can be either the first or the second parameter passed into the method.</p>
<p>It also can be an ES7 <code>async</code> function.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1257">line 1257</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Task.html">Task</a>,<a href="Database.html#task">Database.task</a>,<a href="Database.html#tx">Database.tx</a>,<a href="Database.html#txIf">Database.txIf</a>,<a href="global.html#TaskContext">TaskContext</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object with the result from the callback function.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="tx"><span class="type-signature"></span>tx<span class="signature">(options<span class="signature-attributes">opt</span>, cb)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a callback function as a transaction, with automatically managed connection.</p>
<p>When invoked on the root <a href="Database.html">Database</a> object, the method allocates the connection from the pool,
executes the callback, and once finished - releases the connection back to the pool.
However, when invoked inside another task or transaction, the method reuses the parent connection.</p>
<p>A transaction wraps a regular <a href="Database.html#task">task</a> into additional queries:</p>
<ul>
<li>it executes <code>BEGIN</code> just before invoking the callback function</li>
<li>it executes <code>COMMIT</code>, if the callback didn't throw any error or return a rejected promise</li>
<li>it executes <code>ROLLBACK</code>, if the callback did throw an error or return a rejected promise</li>
<li>it executes corresponding <code>SAVEPOINT</code> commands when the method is called recursively.</li>
</ul>
<p>The callback function is called with one parameter - database protocol (same as <code>this</code>), extended with methods
<a href="Task.html#batch">batch</a>, <a href="Task.html#page">page</a>, <a href="Task.html#sequence">sequence</a>, plus property <a href="Task.html#ctx">ctx</a> -
the transaction context object. See class <a href="Task.html">Task</a> for more details.</p>
<p>Note that transactions should be chosen over tasks only where necessary, because unlike regular tasks,
transactions are blocking operations.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>
|

<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>This parameter is optional, and presumed skipped when the first parameter is a function (<code>cb</code> parameter).</p>
<p>When it is of type <code>string</code> or <code>number</code>, it is assumed to be option <code>tag</code> passed in directly. Otherwise,
it is expected to be an object with options as listed below.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tag</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Traceable context for the transaction (see <a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>mode</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="txMode.TransactionMode.html">txMode.TransactionMode</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Transaction Configuration Mode - extends the transaction-opening command with additional configuration.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Transaction callback function, to return the result that will determine either success or failure for the operation.</p>
<p>The function can be either the first of the second parameter passed into the method.</p>
<p>It also can be an ES7 <code>async</code> function.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1327">line 1327</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Task.html">Task</a>,<a href="Database.html#task">Database.task</a>,<a href="Database.html#taskIf">Database.taskIf</a>,<a href="global.html#TaskContext">TaskContext</a>,<a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>,<a href="https://github.com/vitaly-t/pg-promise/wiki/Chaining-Queries">Chaining Queries</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object with the result from the callback function.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>db.tx('my-transaction', t => {        // t.ctx = transaction context object        return t.one('INSERT INTO Users(name, age) VALUES($1, $2) RETURNING id', ['Mike', 25])            .then(user => {                return t.batch([                    t.none('INSERT INTO Events(userId, name) VALUES($1, $2)', [user.id, 'created']),                    t.none('INSERT INTO Events(userId, name) VALUES($1, $2)', [user.id, 'login'])                ]);            });    })    .then(data => {        // success        // data = as returned from the transaction's callback    })    .catch(error => {        // error    });</code></pre>

    <pre class="prettyprint"><code>// using an ES7 syntax for the callback:db.tx('my-transaction', async t => {        // t.ctx = transaction context object        const user = await t.one('INSERT INTO Users(name, age) VALUES($1, $2) RETURNING id', ['Mike', 25]);        return t.none('INSERT INTO Events(userId, name) VALUES($1, $2)', [user.id, 'created']);    })    .then(data => {        // success        // data = as returned from the transaction's callback    })    .catch(error => {        // error    });</code></pre>



        
            

    

    
    <h4 class="name" id="txIf"><span class="type-signature"></span>txIf<span class="signature">(options<span class="signature-attributes">opt</span>, cb)</span><span class="type-signature"> &rarr; {<a href="external-Promise.html">external:Promise</a>}</span></h4>
    

    



<div class="description">
    <p>Executes a conditional transaction that results in an actual transaction (<a href="Database.html#tx">tx</a>), if the condition is met,
or else it executes a regular <a href="Database.html#task">task</a>.</p>
<p>The default condition is <code>not in transaction</code>, to start a transaction only if currently not in transaction,
or else start a task, which is the same as calling the following:</p>
<pre class="prettyprint source lang-js"><code>db.txIf({cnd: t => !t.ctx || !t.ctx.inTransaction}, cb => {})
</code></pre>
<p>It is useful when you want to avoid <a href="https://github.com/vitaly-t/pg-promise#nested-transactions">Nested Transactions</a> - savepoints.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>
|

<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>This parameter is optional, and presumed skipped when the first parameter is a function (<code>cb</code> parameter).</p>
<p>When it is of type <code>string</code> or <code>number</code>, it is assumed to be option <code>tag</code> passed in directly. Otherwise,
it is expected to be an object with options as listed below.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tag</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Traceable context for the task/transaction (see <a href="https://github.com/vitaly-t/pg-promise/wiki/tags">tags</a>).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>mode</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="txMode.TransactionMode.html">txMode.TransactionMode</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Transaction Configuration Mode - extends the transaction-opening command with additional configuration.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cnd</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Condition for opening a transaction (<a href="Database.html#tx">tx</a>), if it is met, or a <a href="Database.html#task">task</a> when the condition is not met.
It can be either a simple boolean, or a callback function that takes the task/tx context as <code>this</code> and as the first parameter.</p>
<p>Default condition (when it is not specified):</p>
<pre class="prettyprint source lang-js"><code>{cnd: t => !t.ctx || !t.ctx.inTransaction}
</code></pre></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>reusable</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>When <code>cnd</code> is/returns false, reuse context of the current task/transaction, if one exists.
It can be either a simple boolean, or a callback function that takes the task/tx context as <code>this</code>
and as the first parameter.</p>
<p>By default, when <code>cnd</code> is/returns false, the method creates a new task. This option tells
the method to reuse the current task/transaction context, and not create a new task.</p>
<p>This option is ignored when executing against the top level of the protocol, because on
that level, if no transaction is suddenly needed, a new task becomes necessary.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Transaction/task callback function, to return the result that will determine either
success or failure for the operation.</p>
<p>The function can be either the first or the second parameter passed into the method.</p>
<p>It also can be an ES7 <code>async</code> function.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1423">line 1423</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="Task.html">Task</a>,<a href="Database.html#task">Database.task</a>,<a href="Database.html#taskIf">Database.taskIf</a>,<a href="Database.html#tx">Database.tx</a>,<a href="global.html#TaskContext">TaskContext</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise object with the result from the callback function.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="external-Promise.html">external:Promise</a></span>


    </dd>
</dl>

    





        
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                

    

    
    <h4 class="name" id=".streamInitCB"><span class="type-signature"></span>streamInitCB<span class="signature">(stream)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Stream initialization callback, used by <a href="Database.html#stream">Database.stream</a>.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>stream</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="external-Stream.html">external:Stream</a></span>


            
            </td>

            

            

            <td class="description last"><p>Stream object to initialize streaming.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="database.js.html">database.js</a>, <a href="database.js.html#line1600">line 1600</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>const QueryStream = require('pg-query-stream');const JSONStream = require('JSONStream');// you can also use pgp.as.format(query, values, options)// to format queries properly, via pg-promise;const qs = new QueryStream('SELECT * FROM users');db.stream(qs, stream => {        // initiate streaming into the console:        stream.pipe(JSONStream.stringify()).pipe(process.stdout);    })    .then(data => {        console.log('Total rows processed:', data.processed,          'Duration in milliseconds:', data.duration);    })    .catch(error => {        // error;    });</code></pre>



            
    

    
</article>

</section>




</div>

<br class="clear">

<footer>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>